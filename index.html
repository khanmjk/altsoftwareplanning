<!DOCTYPE html>
<html>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<link href="https://unpkg.com/tabulator-tables@5.5.2/dist/css/tabulator.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
<link href="https://unpkg.com/tabulator-tables@5.5.2/dist/css/tabulator_simple.min.css" rel="stylesheet">
<link rel="stylesheet" href="css/style.css">
<link rel="stylesheet" href="css/layout/main-layout.css">
<link rel="stylesheet" href="css/layout/sidebar.css">
<link rel="stylesheet" href="css/components/header.css">
<link rel="stylesheet" href="css/components/enhancedTableWidget.css">
<link rel="stylesheet" href="css/components/aiChatPanel.css">
<link rel="stylesheet" href="css/components/ganttChart.css">
<link rel="stylesheet" href="css/components/Modal.css">
<link rel="stylesheet" href="css/components/SystemSelectionModal.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/frappe-gantt@0.6.1/dist/frappe-gantt.css">



<meta charset="UTF-8">
</head>

<body>
    <div id="app-container">
        <!-- Sidebar -->
        <div id="sidebar">
            <div class="logo-area">
                <i class="fas fa-layer-group logo-icon"></i>
                SMT Platform
            </div>
            <div class="system-switcher-container">
                <div class="system-switcher-btn" data-toggle="dropdown" data-target="system-dropdown">
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <div
                            style="width: 24px; height: 24px; background: var(--primary-color, #3b82f6); border-radius: 4px; display: flex; align-items: center; justify-content: center; font-size: 0.7rem; font-weight: bold;">
                            S</div>
                        <div class="system-name-display" style="font-size: 0.9rem; font-weight: 600;">My System</div>
                    </div>
                    <i class="fas fa-chevron-down" style="font-size: 0.7rem; color: #64748b;"></i>
                </div>
                <div id="system-dropdown" class="dropdown-menu">
                    <div class="dropdown-item" onclick="if(window.loadSystem) window.loadSystem()">
                        <i class="fas fa-folder-open" style="width: 20px;"></i> Load System
                    </div>
                    <div class="dropdown-item" onclick="if(window.createNewSystem) window.createNewSystem()">
                        <i class="fas fa-plus-circle" style="width: 20px;"></i> New System
                    </div>
                    <div style="height: 1px; background: #475569; margin: 5px 0;"></div>
                    <div class="dropdown-item" onclick="if(window.returnToHome) window.returnToHome()">
                        <i class="fas fa-times-circle" style="width: 20px;"></i> Close System
                    </div>
                </div>
            </div>

            <div class="nav-groups">
                <div class="nav-group-title">Planning</div>
                <a href="#" class="nav-item" data-view="planningView">
                    <div class="nav-icon"><i class="far fa-calendar-alt"></i></div>
                    <div class="nav-text">Year Plan</div>
                </a>
                <a href="#" class="nav-item" data-view="ganttPlanningView">
                    <div class="nav-icon"><i class="fas fa-stream"></i></div>
                    <div class="nav-text">Detailed Planning</div>
                </a>
                <a href="#" class="nav-item" data-view="capacityConfigView">
                    <div class="nav-icon"><i class="fas fa-sliders-h"></i></div>
                    <div class="nav-text">Capacity Tuning</div>
                </a>
                <a href="#" class="nav-item" data-view="sdmForecastingView">
                    <div class="nav-icon"><i class="fas fa-chart-line"></i></div>
                    <div class="nav-text">Resource Forecast</div>
                </a>

                <div class="nav-group-title">Product</div>
                <a href="#" class="nav-item" data-view="roadmapView">
                    <div class="nav-icon"><i class="fas fa-map"></i></div>
                    <div class="nav-text">Roadmap & Backlog</div>
                </a>

                <div class="nav-group-title">System</div>
                <a href="#" class="nav-item" data-view="visualizationCarousel">
                    <div class="nav-icon"><i class="fas fa-sitemap"></i></div>
                    <div class="nav-text">System Overview</div>
                </a>
                <a href="#" class="nav-item" data-view="organogramView">
                    <div class="nav-icon"><i class="fas fa-users"></i></div>
                    <div class="nav-text">Org Design</div>
                </a>
                <a href="#" class="nav-item" data-view="systemEditForm">
                    <div class="nav-icon"><i class="fas fa-cog"></i></div>
                    <div class="nav-text">Edit System</div>
                </a>

                <div class="nav-group-title">Insights</div>
                <a href="#" class="nav-item" data-view="dashboardView">
                    <div class="nav-icon"><i class="fas fa-tachometer-alt"></i></div>
                    <div class="nav-text">Dashboard</div>
                </a>

                <div class="nav-group-title">Configuration</div>
                <div style="position: relative;">
                    <a href="#" class="nav-item" data-toggle="dropdown" data-target="settings-dropdown">
                        <div class="nav-icon"><i class="fas fa-wrench"></i></div>
                        <div class="nav-text">Settings</div>
                    </a>
                    <div id="settings-dropdown" class="dropdown-menu"
                        style="bottom: 100%; left: 0; margin-bottom: 5px;">
                        <div class="dropdown-item"
                            onclick="if(window.openAiSettingsModal) window.openAiSettingsModal()">
                            <i class="fas fa-robot" style="width: 20px;"></i> AI Settings
                        </div>
                        <div class="dropdown-item" onclick="if(window.resetToDefaults) window.resetToDefaults()">
                            <i class="fas fa-undo" style="width: 20px;"></i> Reset Defaults
                        </div>
                        <div style="height: 1px; background: #475569; margin: 5px 0;"></div>
                        <div class="dropdown-item danger" onclick="if(window.deleteSystem) window.deleteSystem()">
                            <i class="fas fa-trash-alt" style="width: 20px;"></i> Delete System
                        </div>
                    </div>
                </div>

                <div class="nav-group-title">Help</div>
                <a href="#" class="nav-item" data-view="helpView">
                    <div class="nav-icon"><i class="fas fa-book"></i></div>
                    <div class="nav-text">How to Guide</div>
                </a>
            </div>
            <div class="user-profile">
                <div class="avatar">U</div>
                <div style="font-size: 0.9rem;">User Profile</div>
            </div>
        </div>

        <div id="main-content-wrapper">
            <header id="main-header">
                <div class="breadcrumbs"></div>
                <div class="header-actions">
                    <button id="header-ai-btn" class="header-btn" title="AI Assistant"><i
                            class="fas fa-robot"></i></button>
                    <button class="header-btn" title="Notifications"><i class="fas fa-bell"></i></button>
                </div>
            </header>

            <div id="main-content-area">


                <div id="welcomeView" style="display:none; padding: 40px; max-width: 1200px; margin: 0 auto;">
                    <div style="text-align: center; margin-bottom: 60px;">
                        <h1 style="font-size: 2.5rem; color: #1e293b; margin-bottom: 15px;">Welcome to SMT Platform</h1>
                        <p style="font-size: 1.1rem; color: #64748b; max-width: 800px; margin: 0 auto;">
                            Your comprehensive, one-stop shop for Software Managers. Plan roadmaps, visualize
                            architecture, forecast resources, and manage team capacity—all in one unified workspace.
                        </p>
                    </div>

                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 30px;">
                        <!-- Load System Card -->
                        <div class="action-card" onclick="if(window.loadSystem) window.loadSystem()"
                            style="background: white; padding: 30px; border-radius: 12px; border: 1px solid #e2e8f0; cursor: pointer; transition: all 0.2s; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);">
                            <div
                                style="width: 50px; height: 50px; background: #eff6ff; border-radius: 10px; display: flex; align-items: center; justify-content: center; margin-bottom: 20px; color: #3b82f6;">
                                <i class="fas fa-folder-open" style="font-size: 1.5rem;"></i>
                            </div>
                            <h3 style="font-size: 1.25rem; margin-bottom: 10px; color: #0f172a;">Load Existing System
                            </h3>
                            <p style="color: #64748b; font-size: 0.95rem;">Access your saved architecture plans,
                                roadmaps, and capacity configurations.</p>
                        </div>

                        <!-- Create System Card -->
                        <div class="action-card" onclick="if(window.createNewSystem) window.createNewSystem()"
                            style="background: white; padding: 30px; border-radius: 12px; border: 1px solid #e2e8f0; cursor: pointer; transition: all 0.2s; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);">
                            <div
                                style="width: 50px; height: 50px; background: #f0fdf4; border-radius: 10px; display: flex; align-items: center; justify-content: center; margin-bottom: 20px; color: #22c55e;">
                                <i class="fas fa-plus-circle" style="font-size: 1.5rem;"></i>
                            </div>
                            <h3 style="font-size: 1.25rem; margin-bottom: 10px; color: #0f172a;">Create New System</h3>
                            <p style="color: #64748b; font-size: 0.95rem;">Start a new project from scratch. Define
                                teams, services, and strategic goals.</p>
                        </div>

                        <!-- Create with AI Card (Hidden by default) -->
                        <div id="createWithAiCard" class="action-card"
                            onclick="if(window.handleCreateWithAi) window.handleCreateWithAi()"
                            style="display: none; background: white; padding: 30px; border-radius: 12px; border: 1px solid #e2e8f0; cursor: pointer; transition: all 0.2s; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);">
                            <div
                                style="width: 50px; height: 50px; background: #f3e8ff; border-radius: 10px; display: flex; align-items: center; justify-content: center; margin-bottom: 20px; color: #a855f7;">
                                <i class="fas fa-magic" style="font-size: 1.5rem;"></i>
                            </div>
                            <h3 style="font-size: 1.25rem; margin-bottom: 10px; color: #0f172a;">Create with AI</h3>
                            <p style="color: #64748b; font-size: 0.95rem;">Generate a complete system architecture and
                                plan using AI assistance.</p>
                        </div>

                        <!-- Documentation Card -->
                        <div class="action-card"
                            onclick="if(window.navigationManager) window.navigationManager.navigateTo('helpView')"
                            style="background: white; padding: 30px; border-radius: 12px; border: 1px solid #e2e8f0; cursor: pointer; transition: all 0.2s; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);">
                            <div
                                style="width: 50px; height: 50px; background: #f8fafc; border-radius: 10px; display: flex; align-items: center; justify-content: center; margin-bottom: 20px; color: #64748b;">
                                <i class="fas fa-book" style="font-size: 1.5rem;"></i>
                            </div>
                            <h3 style="font-size: 1.25rem; margin-bottom: 10px; color: #0f172a;">Documentation</h3>
                            <p style="color: #64748b; font-size: 0.95rem;">Learn how to use the platform, best practices
                                for modeling, and more.</p>
                        </div>
                    </div>

                    <style>
                        .action-card:hover {
                            transform: translateY(-5px);
                            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
                            border-color: #cbd5e1;
                        }
                    </style>
                </div>
            </div>

            <div id="aiGenerationStatsModal" class="modal">
                <div class="modal-content-wrapper">
                    <div class="modal-header">
                        <h3>AI Generation Statistics</h3>
                        <span class="close-button" onclick="closeAiStatsModal()">&times;</span>
                    </div>
                    <div class="modal-body">
                        <pre id="aiGenerationStatsContent" class="ai-stats-pre"></pre>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn-primary" onclick="closeAiStatsModal()">Got it</button>
                    </div>
                </div>
            </div>


            <div id="visualizationCarousel" style="display:none;">
                <div style="text-align: center; margin-bottom: 10px;">
                    <button onclick="navigateVisualizations(-1)">&lt; Previous</button>
                    <span id="visualizationTitle" style="margin: 0 15px; font-weight: bold; font-size: 1.1em;">System
                        Visualization</span> <button onclick="navigateVisualizations(1)">Next &gt;</button>
                </div>

                <div id="visualization" class="carousel-item" style="display: block;"> <button
                        id="togglePlatformComponentsSystem" class="button" style="margin-bottom: 10px;">Hide
                        Platforms</button>
                    <svg id="systemSvg" style="width: 100%; height: 600px; border: 1px solid #ccc;"></svg>
                    <div id="legend" class="legend"></div>
                </div>

                <div id="teamVisualization" class="carousel-item" style="display: none;">
                    <svg id="teamSvg" style="width: 100%; height: 600px; border: 1px solid #ccc;"></svg>
                    <div id="teamLegend" class="legend"></div>
                </div>

                <div id="serviceRelationshipsVisualization" class="carousel-item" style="display: none;">
                    <select id="serviceSelection" onchange="updateServiceVisualization()"
                        style="margin-bottom: 5px; display: block; margin-left: auto; margin-right: auto;">
                    </select>
                    <button id="togglePlatformComponentsService" class="button" style="margin-bottom: 10px;">Hide
                        Platforms</button>
                    <svg id="serviceSvg" style="width: 100%; height: 600px; border: 1px solid #ccc;"></svg>
                    <div id="serviceLegend" class="legend"></div>
                </div>

                <div id="dependencyVisualization" class="carousel-item" style="display: none;">
                    <select id="dependencyServiceSelection" onchange="updateDependencyVisualization()"
                        style="margin-bottom: 5px; display: block; margin-left: auto; margin-right: auto;">
                    </select>
                    <button id="togglePlatformComponentsDependency" class="button" style="margin-bottom: 10px;">Hide
                        Platforms</button>
                    <svg id="dependencySvg" style="width: 100%; height: 600px; border: 1px solid #ccc;"></svg>
                <div id="dependencyLegend" class="legend"></div>
            </div>

            <div id="serviceDependenciesTableSlide" class="carousel-item" style="display: none;">
                <div id="serviceDependenciesTable" style="max-width: 100%; margin: 8px auto 0 auto;">
                    <h2>Service Dependencies Table</h2>
                    <div id="serviceDependenciesTableHost"></div>
                </div>
            </div>

            <div id="mermaidVisualization" class="carousel-item" style="display: none;">
                <div id="mermaidGraph"></div>
            </div>

                <div id="mermaidApiVisualization" class="carousel-item" style="display: none;">
                    <select id="apiServiceSelection"
                        style="margin-bottom: 10px; display: block; margin-left: auto; margin-right: auto;"></select>
                    <div id="mermaidApiGraph"></div>
                </div>

            </div>


            <div id="systemEditForm" style="display:none;">
                <h2>Edit System</h2>
                <form id="editSystemForm">
                    <label>System Name:</label><br>
                    <input type="text" id="systemNameInput"><br><br>
                    <label>System Description:</label><br>
                    <textarea id="systemDescriptionInput"></textarea><br><br>
                    <button type="button" class="btn-primary" onclick="saveSystemDetails()">Save System
                        Details</button>
                </form>

                <h3>Services</h3>
                <div id="editServicesManagement">
                </div>
                <button type="button" onclick="addNewService()">Add New Service</button><br><br>

                <h3>Teams</h3>
                <div id="teamsManagement">
                </div>
                <button id="addNewTeamButton" type="button" onclick="addNewTeam()">Add New Team</button><br><br>

                <button type="button" class="btn-primary" onclick="saveAllChanges()">Save All Changes</button>
                <button type="button" onclick="exitEditMode()">Cancel</button>
            </div>


            <div id="organogramView" style="display:none;">
                <div id="organogramToolbar" style="margin-bottom: 10px;">
                </div>
                <div id="organogramContent" style="border: 1px solid #ccc; padding: 15px;">
                </div>

                <div id="teamBreakdown" style="margin-top: 30px;">
                    <h2>Team Breakdown</h2>
                    <p id="levelKey" style="font-size: 0.9em; color: #555; margin-bottom: 10px;"></p>
                    <table id="teamTable">
                        <thead>
                        </thead>
                        <tbody>
                        </tbody>
                        <tfoot>
                        </tfoot>
                    </table>
                </div>
                <div id="orgEngineerListView" style="display:none; margin-top: 20px;">
                </div>
            </div>

            <div id="planningView" style="display:none; margin-top: 0;">
                <div id="planningCapacitySummary"
                    style="margin-bottom: 15px; font-weight: bold; padding: 8px; background-color: #f8f9fa; border: 1px solid #dee2e6; border-radius: 4px;">
                </div>

                <div id="planningScenarioControl"
                    style="margin-bottom: 15px; padding: 8px; background-color: #f8f9fa; border: 1px solid #dee2e6; border-radius: 4px;">
                </div>

                <div id="teamLoadSummarySection"
                    style="margin-bottom: 20px; border: 1px solid #ccc; border-radius: 4px;">
                    <h4 onclick="toggleCollapsibleSection('teamLoadSummaryContent', 'teamLoadSummaryToggle')"
                        style="cursor: pointer; margin: 0; padding: 10px; background-color: #e9ecef; border-bottom: 1px solid #ccc;"
                        title="Click to expand/collapse team load summary">
                        <span id="teamLoadSummaryToggle" class="toggle-indicator">(+) </span> Team Load Summary (for
                        ATL
                        Initiatives)
                    </h4>
                    <div id="teamLoadSummaryContent" style="display: none; padding: 10px;">
                        <p style="font-size: 0.9em; color: #555;">Shows team load based *only* on initiatives
                            currently
                            Above The Line (ATL) according to the selected scenario below.</p>
                        <table id="teamLoadSummaryTable"
                            style="margin: 0 auto; border-collapse: collapse; font-size: 0.9em;">
                            <thead>
                                <tr style="background-color: #f2f2f2;">
                                    <th style="border: 1px solid #ccc; padding: 5px;">Team Name</th>
                                    <th style="border: 1px solid #ccc; padding: 5px;" title="Finance Approved Budget">
                                        Funded HC</th>
                                    <th style="border: 1px solid #ccc; padding: 5px;" title="Actual Team Members">
                                        Team
                                        BIS</th>
                                    <th style="border: 1px solid #ccc; padding: 5px;" title="Borrowed/Away Members">
                                        Away
                                        BIS</th>
                                    <th style="border: 1px solid #ccc; padding: 5px;" title="Team BIS + Away BIS">
                                        Effective BIS</th>
                                    <th style="border: 1px solid #ccc; padding: 5px;"
                                        title="SDEs assigned to this team from ATL initiatives only">Assigned ATL
                                        SDEs
                                    </th>
                                    <th style="border: 1px solid #ccc; padding: 5px;"
                                        title="Team's capacity based on selected scenario button below">Scenario
                                        Capacity Limit</th>
                                    <th style="border: 1px solid #ccc; padding: 5px;"
                                        title="Scenario Capacity Limit - Assigned ATL SDEs">Remaining Capacity (ATL)
                                    </th>
                                    <th style="border: 1px solid #ccc; padding: 5px;"
                                        title="Load status for ATL work based on Scenario Capacity Limit">ATL Status
                                    </th>
                                </tr>
                            </thead>
                            <tbody id="teamLoadSummaryTableBody">
                            </tbody>
                            <tfoot id="teamLoadSummaryTableFoot" style="font-weight: bold;">
                            </tfoot>
                        </table>
                    </div>
                </div>

                <div id="planningTableContainer">
                </div>
            </div>
            <div id="roadmapView"
                style="display:none; margin-top: 20px; max-width: 95%; margin-left: auto; margin-right: auto;">
                <div id="roadmapControlsContainer"
                    style="margin-bottom: 15px; padding: 10px; background-color: #f8f9fa; border: 1px solid #dee2e6; border-radius: 4px;">
                </div>
                <div id="roadmapTableContainer" style="margin-bottom: 20px;">
                </div>

            </div>
            <div id="dashboardView" style="display:none; margin-top: 20px;">
            </div>

            <div id="capacityConfigView"
                style="display:none; margin-top: 0; max-width: 90%; margin-left: auto; margin-right: auto;">
            </div>
            <div id="sdmForecastingView"
                style="display:none; margin-top: 0; max-width: 90%; margin-left: auto; margin-right: auto;">
            </div>

            <div id="helpView"
                style="display:none; margin-top: 0; max-width: 90%; margin-left: auto; margin-right: auto;">
                <div id="documentationContent" style="padding: 15px; background-color: #fdfdfd;">
                    <p><em>Loading documentation... Please ensure you have an internet connection to fetch the
                            latest
                            help content.</em></p>
                </div>
            </div>
            <div id="ganttPlanningView" style="display:none; margin-top: 20px;">
                <div class="gantt-controls"
                    style="margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center;">
                    <div class="view-modes">
                        <span style="margin-right: 10px; font-weight: 500;">View:</span>
                        <div class="btn-group" role="group">
                            <button type="button" class="btn-sm btn-outline-secondary"
                                data-view-mode="Quarter Day">Quarter Day</button>
                            <button type="button" class="btn-sm btn-outline-secondary" data-view-mode="Half Day">Half
                                Day</button>
                            <button type="button" class="btn-sm btn-outline-secondary" data-view-mode="Day">Day</button>
                            <button type="button" class="btn-sm btn-outline-secondary"
                                data-view-mode="Week">Week</button>
                            <button type="button" class="btn-sm btn-outline-secondary active"
                                data-view-mode="Month">Month</button>
                        </div>
                    </div>
                    <div class="gantt-legend" style="display: flex; gap: 15px; font-size: 12px; align-items: center;">
                        <div style="display: flex; align-items: center;"><span
                                style="width: 12px; height: 12px; background-color: #6f42c1; display: inline-block; margin-right: 5px; border-radius: 2px;"></span>
                            Initiative</div>
                        <div style="display: flex; align-items: center;"><span
                                style="width: 12px; height: 12px; background-color: #0366d6; display: inline-block; margin-right: 5px; border-radius: 2px;"></span>
                            Work Package</div>
                        <div style="display: flex; align-items: center;"><span
                                style="width: 12px; height: 12px; background-color: #2ea44f; display: inline-block; margin-right: 5px; border-radius: 2px;"></span>
                            Assignment</div>
                    </div>
                </div>
            </div>


            <div id="themeManagementModal" class="modal" style="display:none;">
                <div class="modal-content-wrapper">
                    <div class="modal-header">
                        <h3 id="themeManagementModalTitle">Manage Themes</h3>
                        <span class="close-button" onclick="closeThemeManagementModal()">&times;</span>
                    </div>
                    <div class="modal-body">
                        <h4>Existing Themes</h4>
                        <div id="existingThemesList"
                            style="margin-bottom: 20px; max-height: 200px; overflow-y: auto; border: 1px solid #eee; padding:5px;">
                            <p><em>No themes defined yet or loading...</em></p>
                        </div>

                        <h4>Add New Theme</h4>
                        <form id="addNewThemeForm_modal">
                            <div style="margin-bottom: 10px;">
                                <label for="newThemeName_modal" style="display: block;">Theme Name:</label>
                                <input type="text" id="newThemeName_modal" style="width: 95%;" required>
                            </div>
                            <div style="margin-bottom: 10px;">
                                <label for="newThemeDescription_modal" style="display: block;">Description
                                    (Optional):</label>
                                <textarea id="newThemeDescription_modal" rows="2" style="width: 95%;"></textarea>
                            </div>
                            <button type="button" id="saveNewThemeButton_modal" class="btn-primary">Add
                                Theme</button>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn-secondary" onclick="closeThemeManagementModal()">Close</button>
                    </div>
                </div>
            </div>
            <div id="roadmapInitiativeModal" class="modal" style="display:none;">
                <div class="modal-content-wrapper">
                    <div class="modal-header">
                        <h3 id="addEditRoadmapInitiativeTitle_modal">Add/Edit Initiative</h3>
                        <span class="close-button" onclick="closeRoadmapModal()">&times;</span>
                    </div>
                    <div class="modal-body">
                        <form id="roadmapInitiativeForm_modal">
                            <p><em>Loading form...</em></p>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" id="saveRoadmapInitiativeButton_modal" class="btn-primary">Save
                            Initiative</button>
                        <button type="button" id="cancelRoadmapInitiativeEditButton_modal" class="btn-secondary"
                            style="margin-left: 10px;" onclick="closeRoadmapModal()">Cancel</button>
                    </div>
                </div>
            </div>
            <div id="aiSettingsModal" class="modal" style="display:none;">
                <div class="modal-content-wrapper">
                    <div class="modal-header">
                        <h3 id="aiSettingsModalTitle">AI Assistant Settings</h3>
                        <span class="close-button" onclick="closeAiSettingsModal()">&times;</span>
                    </div>
                    <div class="modal-body">
                        <form id="aiSettingsForm">
                            <div style="margin-bottom: 15px;">
                                <input type="checkbox" id="aiModeEnabled" name="aiModeEnabled"
                                    style="margin-right: 8px; vertical-align: middle;">
                                <label for="aiModeEnabled" style="font-weight: bold; vertical-align: middle;">Enable
                                    AI
                                    Assistant Mode</label>
                            </div>

                            <div id="aiConfigInputs" style="display:none;">
                                <hr style="margin-bottom: 15px;">
                                <div style="margin-bottom: 15px;">
                                    <label for="aiProviderSelect" style="display: block; margin-bottom: 5px;">LLM
                                        Provider:</label>
                                    <select id="aiProviderSelect" name="aiProviderSelect">
                                        <option value="google-gemini">Google (Gemini Pro)</option>
                                        <option value="openai-gpt4o" disabled>OpenAI (GPT-4o)</option>
                                        <option value="anthropic-claude35" disabled>Anthropic (Claude 3.5 Sonnet)
                                        </option>
                                        <option value="mistral-large" disabled>Mistral (Large 2)</option>
                                        <option value="cohere-command-r" disabled>Cohere (Command R)</option>
                                    </select>
                                </div>
                                <div style="margin-bottom: 15px;">
                                    <label for="aiApiKeyInput" style="display: block; margin-bottom: 5px;">Your API
                                        Key:</label>
                                    <input type="password" id="aiApiKeyInput" name="aiApiKeyInput" style="width: 95%;"
                                        placeholder="Paste your API key here">
                                    <div class="api-key-disclaimer"
                                        style="font-size: 0.85em; color: #6c757d; margin-top: 8px; padding: 8px; border: 1px solid #ced4da; border-radius: 4px; background-color: #f8f9fa;">
                                        <p style="margin-top: 0; margin-bottom: 5px;">
                                            You must use a <strong>FREE API key</strong>. You can get one from <a
                                                href="https://aistudio.google.com/app/apikey" target="_blank"
                                                rel="noopener noreferrer">Google AI Studio</a>.
                                        </p>
                                        <p
                                            style="margin-bottom: 5px; color: #856404; background-color: #fff3cd; border: 1px solid #ffeeba; padding: 8px; border-radius: 4px;">
                                            <strong>Note:</strong> Free-tier keys often have strict rate limits. If
                                            you
                                            see a <strong>"503: Model Overloaded"</strong> error, it means the
                                            service
                                            is busy. The app will retry, but you may need to wait and try again
                                            later.
                                        </p>
                                        <p style="margin-bottom: 5px;">
                                            <strong>Disclaimer:</strong> This is a client-side application. Your API
                                            key
                                            is stored exclusively in your browser's local storage and is never sent
                                            to
                                            any server other than the selected LLM provider.
                                        </p>
                                        <p style="margin-bottom: 0;">
                                            Using this app comes with risks. The author is not liable for any issues
                                            that arise from using your own private (non-free-tier) API key.
                                        </p>
                                        <p
                                            style="margin-top: 10px; margin-bottom: 0; font-style: italic; color: #c62828;">
                                            <strong>Image Generation (Imagen):</strong> Currently mocked. Google’s
                                            Imagen API requires a backend proxy with OAuth2 credentials. Until that
                                            proxy exists, the app will return a placeholder diagram. See the README
                                            section “Image Generation Status (Imagen)” for details.
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" id="saveAiSettingsButton" class="btn-primary">Save Settings</button>
                        <button type="button" class="btn-secondary" style="margin-left: 10px;"
                            onclick="closeAiSettingsModal()">Cancel</button>
                    </div>
                </div>
            </div>
        </div> <!-- end #main-content-area -->

        <div id="chatResizeHandle" style="display: none;"></div>
        <div id="aiChatPanelContainer"></div>

    </div> <!-- end #main-content-wrapper -->
    </div> <!-- end #app-container -->
    <div id="aiLoadingSpinner" class="spinner-overlay" style="display:none;">
        <div class="spinner"></div>
        <p>AI is generating your system... This may take a moment.</p>
    </div>

    <div id="diagramModal" class="modal">
        <div class="modal-content-wrapper" style="width: 95%; height: 95%; max-width: none;">
            <div class="modal-header">
                <h3 id="diagramModalTitle">Generated Diagram</h3>
                <span class="close-button" onclick="closeDiagramModal()">&times;</span>
            </div>
            <div class="modal-body"
                style="overflow: hidden; background-color: #fff; display: flex; flex-direction: column; padding: 0;">
                <div id="diagramModalContent" class="mermaid"
                    style="flex-grow: 1; overflow: auto; display: flex; justify-content: center; align-items: center;">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-secondary" onclick="closeDiagramModal()">Close</button>
            </div>
        </div>
    </div>
    <script src="js/data.js"></script>
    <script src="js/utils.js"></script>

    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/frappe-gantt@0.6.1/dist/frappe-gantt.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/markdown-it/12.3.2/markdown-it.min.js"></script>
    <script src="https://unpkg.com/markdown-it-anchor@8.6.7/dist/markdownItAnchor.umd.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/luxon/3.4.4/luxon.min.js"></script>
    <script type="text/javascript" src="https://unpkg.com/tabulator-tables@5.5.2/dist/js/tabulator.min.js"></script>
    <script type="text/javascript" src="https://oss.sheetjs.com/sheetjs/xlsx.full.min.js"></script>
    <script src="js/sampleData/sampleStreamingPlatform.js"></script>
    <script src="js/sampleData/sampleContactCenterPlatform.js"></script>
    <script src="js/sampleData/sampleShopSphere.js"></script>
    <script src="js/sampleData/sampleInsightAI.js"></script>
    <script src="js/sampleData/sampleFinSecure.js"></script>

    <script src="js/components/enhancedTableWidget.js"></script>
    <script src="js/documentation.js"></script>
    <script src="js/sdmForecasting.js"></script>
    <script src="js/mermaidGenerator.js"></script>
    <script src="js/visualizations.js"></script>
    <script src="js/editSystem.js"></script>
    <script src="js/orgView.js"></script>
    <script src="js/yearPlanning.js"></script>
    <script src="js/capacityTuning.js"></script>
    <script src="js/roadmap.js"></script>
    <script src="js/roadmapTableView.js"></script>
    <script src="js/goalsView.js"></script>
    <script src="js/accomplishmentsView.js"></script>
    <script src="js/impactView.js"></script>
    <script src="js/dashboard.js"></script>

    <script src="js/featureFlags.js"></script>
    <script src="js/components/gantt/GanttRenderer.js"></script>
    <script src="js/components/gantt/MermaidGanttRenderer.js"></script>
    <script src="js/components/gantt/FrappeGanttRenderer.js"></script>
    <script src="js/components/gantt/GanttFactory.js"></script>
    <script src="js/components/gantt/ganttAdapter.js"></script>
    <script src="js/components/gantt/ganttGenerator.js"></script>
    <script src="js/ganttPlanning.js"></script>
    <script src="ai/aiService.js"></script>
    <script src="ai/aiChatAssistant.js"></script>
    <script src="ai/aiAgentToolset.js"></script>
    <script src="ai/aiPlanOptimizationAgent.js"></script>
    <script src="ai/aiAgentController.js"></script>

    <script src="js/managers/NavigationManager.js"></script>
    <script src="js/components/SidebarComponent.js"></script>
    <script src="js/components/HeaderComponent.js"></script>
    <script src="js/components/DocumentationComponent.js"></script>
    <script src="js/components/SystemSelectionModal.js"></script>
    <script src="js/main.js"></script>
</body>

</html>
